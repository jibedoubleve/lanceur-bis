<Page x:Class="Lanceur.Ui.WPF.Views.Pages.UsageCalendarView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:interactivity="http://schemas.microsoft.com/xaml/behaviors"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:b="clr-namespace:Lanceur.Ui.WPF.Behaviours"
      xmlns:behaviours="http://schemas.microsoft.com/xaml/behaviors"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      x:Name="Self"
      d:DesignHeight="800"
      d:DesignWidth="800"
      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
      ScrollViewer.CanContentScroll="False"
      mc:Ignorable="d">
    <interactivity:Interaction.Triggers>
        <interactivity:EventTrigger EventName="Loaded">
            <interactivity:InvokeCommandAction Command="{Binding LoadUsageCommand}"
                                               CommandParameter="{x:Static sys:DateTime.Today}" />
        </interactivity:EventTrigger>
    </interactivity:Interaction.Triggers>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>
        <Calendar HorizontalAlignment="Left">
            <interactivity:Interaction.Behaviors>
                <b:CalendarSelectedDateBehaviour Command="{Binding LoadHistoryCommand}" />
            </interactivity:Interaction.Behaviors>
        </Calendar>
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <ui:TextBlock Text="{Binding SelectedDay, Mode=OneWay}"
                          Margin="15,5,5,15"
                          FontTypography="Title" />
            <DataGrid Grid.Row="1" ItemsSource="{Binding History}" 
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="False"
                      EnableColumnVirtualization="True"
                      GridLinesVisibility="Vertical"
                      HeadersVisibility="Column">
                <DataGrid.Columns>
                    <!--  LAST USED  -->
                    <DataGridTemplateColumn Header="Time">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ui:TextBlock
                                    Margin="5,5,50,5"
                                    VerticalAlignment="Center"
                                    FontTypography="BodyStrong"
                                    Text="{Binding Timestamp, StringFormat=HH:mm:ss}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <!--  ICON  -->
                    <DataGridTemplateColumn Width="60" Header="Icon">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border
                                    Width="{StaticResource SmallIconContainerSize}"
                                    Height="{StaticResource SmallIconContainerSize}"
                                    Background="{ui:ThemeResource AccentTextFillColorTertiaryBrush}"
                                    CornerRadius="8">
                                    <behaviours:Interaction.Triggers>
                                        <!-- When the item becomes visible, load the thumbnail -->
                                        <behaviours:EventTrigger EventName="Loaded">
                                            <behaviours:InvokeCommandAction
                                                Command="{Binding DataContext.LoadThumbnailCommand, ElementName=Self}"
                                                CommandParameter="{Binding}" />
                                        </behaviours:EventTrigger>
                                    </behaviours:Interaction.Triggers>
                                    <Grid>
                                        <Image
                                            Width="{StaticResource SmallIconSize}"
                                            Height="{StaticResource SmallIconSize}"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Source="{Binding Thumbnail}"
                                            Visibility="{Binding Thumbnail, Converter={StaticResource NullToVisibilityConverter}}" />
                                        <ui:SymbolIcon
                                            Width="{StaticResource SmallIconSize}"
                                            Height="{StaticResource SmallIconSize}"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Filled="False"
                                            Symbol="{Binding Icon}"
                                            Visibility="{Binding Thumbnail, Converter={StaticResource InvertNullToVisibilityConverter}}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!--  NAME  -->
                    <DataGridTemplateColumn Header="Alias">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ui:TextBlock
                                    Margin="5,5,50,5"
                                    VerticalAlignment="Center"
                                    FontTypography="BodyStrong"
                                    Text="{Binding Name}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Page>